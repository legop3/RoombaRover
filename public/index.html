<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Roomba Rover</title>
    <meta name="description" content="Teleoperate the community Roomba Rover!">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/favicon.ico">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Roomba Rover">
    <meta property="og:description" content="Drive the Roomba Rover!">
    <meta property="og:url" content="https://rover.otter.land/">
    <meta property="og:image" content="https://rover.otter.land/favicon.ico">
    <meta property="og:image:alt" content="Roomba Rover logo">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Roomba Rover Remote Driving">
    <meta name="twitter:description" content="Drive the Roomba!">
    <meta name="twitter:image" content="https://rover.otter.land/favicon.ico">

    <link href="/tailwind.min.css" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/nipplejs.min.js"></script>
    <style>
        body {
            font-family: system-ui, sans-serif;
        }

        .btn {
            padding: 0.5rem 1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease;
            color: white;
        }

        .rainbow-bg { 
            /* height: 100%;
            width: 100%;
            left:0;
            right: 0;
            top: 0;
            bottom: 0;
            position: absolute; */
            background: linear-gradient(124deg, #ff2400, #e81d1d, #e8b71d, #e3e81d, #1de840, #1ddde8, #2b1de8, #dd00f3, #dd00f3);
            background-size: 1800% 1800%;

            -webkit-animation: rainbow 18s ease infinite;
            -z-animation: rainbow 18s ease infinite;
            -o-animation: rainbow 18s ease infinite;
            animation: rainbow 18s ease infinite;}

            @-webkit-keyframes rainbow {
                0%{background-position:0% 82%}
                50%{background-position:100% 19%}
                100%{background-position:0% 82%}
            }
            @-moz-keyframes rainbow {
                0%{background-position:0% 82%}
                50%{background-position:100% 19%}
                100%{background-position:0% 82%}
            }
            @-o-keyframes rainbow {
                0%{background-position:0% 82%}
                50%{background-position:100% 19%}
                100%{background-position:0% 82%}
            }
            @keyframes rainbow { 
                0%{background-position:0% 82%}
                50%{background-position:100% 19%}
                100%{background-position:0% 82%}
            }

            .scrollbar-hidden::-webkit-scrollbar {
                display: none;
            }

            .scrollbar-hidden {
                scrollbar-width: none; /* Firefox */
                -ms-overflow-style: none; /* IE and Edge */
            }

        

        /* Hide scrollbars on Chrome, Safari, Edge */
        *::-webkit-scrollbar {
            display: none !important;
            width: 0 !important;
            background: transparent !important;
        }
        /* Hide scrollbars on Firefox */
        * {
            scrollbar-width: none !important;
            -ms-overflow-style: none !important;
        }

        @media (max-width: 1024px) {
            body {
                touch-action: manipulation;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                -webkit-touch-callout: none;
            }

            #newdrive-root {
                touch-action: manipulation;
            }
        }

        html.force-mobile #layout-default {
            display: none !important;
        }

        html.force-mobile #layout-landscape {
            display: block !important;
            overflow-y: auto !important;
        }

        html.force-mobile body {
            overflow-y: auto !important;
        }

        html.force-mobile main {
            overflow-y: auto !important;
        }

        .layout-toggle-button.layout-toggle-active {
            background-color: #16a34a !important;
            color: #fff !important;
        }

        @layer utilities {
            @media (orientation: portrait) {
                .portrait\:hidden { display: none !important; }
                .portrait\:block { display: block !important; }
                .portrait\:flex { display: flex !important; }
            }

            @media (orientation: landscape) {
                .landscape\:hidden { display: none !important; }
                .landscape\:block { display: block !important; }
                .landscape\:flex { display: flex !important; }
            }

            @media (max-width: 1024px) and (orientation: landscape) {
                .mobile-landscape\:hidden { display: none !important; }
                .mobile-landscape\:block { display: block !important; }
                .mobile-landscape\:flex { display: flex !important; }
                .mobile-landscape\:overflow-y-auto { overflow-y: auto !important; }
                .mobile-landscape\:h-auto { height: auto !important; }
            }
        }
    </style>
</head>
<body class="md:h-screen md:overflow-hidden mobile-landscape:h-auto mobile-landscape:overflow-y-auto bg-black text-white">

    <!-- admin mode overlay -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-xl p-2">
            <p class="" id="overlay-top-caption">Admin only mode is enabled. Please log in. This page reloads automatically every minute.</p>
            <form id="password-form" class="flex flex-col gap-2 sm:flex-row sm:items-center mt-2">
                <input id="password-input" type="password" class="flex-1 rounded-xl bg-gray-700 p-2 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Access code (optional)" />
                <button type="submit" class="w-full sm:w-auto bg-blue-600 text-white rounded-xl px-4 py-2 font-semibold hover:bg-blue-500 transition-colors">Log in</button>
            </form>
            <p class="font-xl p-1 mt-2"><a id="discord-invite-button-overlay" href="#" target="_blank" rel="noopener noreferrer" class="rainbow-bg text-white rounded-xl font-semibold hover:opacity-80 transition-colors text-center btn">Join our Discord server</a> for updates!</p>
            <p class="mt-1">The discord server contains a bot which will update the server on the status of the rover.</p>
        </div>
    </div>

    <div id="newdrive-root" class="md:flex md:h-full md:flex-col mobile-landscape:h-auto mobile-landscape:overflow-y-auto">
        <!-- Main layout container -->
        <main class="md:flex md:flex-1 md:overflow-hidden mobile-landscape:h-auto mobile-landscape:overflow-y-auto">
            <!-- Default layout: desktop & mobile portrait -->
            <section id="layout-default" class="flex flex-col md:flex-1 md:flex-row md:overflow-hidden gap-1 mobile-landscape:hidden">
                <!-- Column 1 -->
                <div class="flex-1 space-y-1 md:h-full md:overflow-y-auto">
                    <!-- put stuff in here for it -->
                    <div class="rounded-xl shadow-md p-1 bg-gray-800">        
                        <div class="relative">
                        <div class="w-full max-w-full mx-auto">
                        <iframe
                            id="avFrame"
                            class="w-full rounded-md border-none"
                            src="https://rover.otter.land/rover-video/"
                            allow="autoplay; fullscreen"
                            data-drive-video="primary"
                        ></iframe>
                        </div>
                        
                            <!-- warning overlays -->
                            <div id="overcurrent-warning" data-hud-role="overcurrent-warning" class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-red-700 bg-opacity-90 p-2 md:px-6 md:py-4 rounded-xl md:text-3xl font-bold text-white z-40 pointer-events-none whitespace-pre text-center shadow-lg"></div>
                            <div id="charge-warning" data-hud-role="charge-warning" class="hidden absolute left-1/2 top-6 transform -translate-x-1/2 bg-red-700 bg-opacity-90 md:px-5 md:py-3 rounded-xl md:text-2xl font-bold text-white z-40 pointer-events-none text-center shadow-lg"></div>
                            
                            <!-- sensor blinker -->
                            <div id="sensorblinker" data-hud-role="sensor-blinker" class=" p-1 rounded-full bg-pink-400 bg-black md:w-5 md:h-5 w-3 h-3 absolute right-1 top-1 md:right-3 md:top-3 opacity-50"></div>

                            <!-- wheel current bars -->
                            <div class="absolute bottom-1 left-1 w-3 md:bottom-3 md:left-3 md:w-5 h-10 bg-gray-700 items-start rounded-full opacity-50 overflow-hidden" data-help="Left Motor Current">
                                <div class="bg-green-500 opactiy-50" style="height: 0%;" id="leftCurrent-bar" data-hud-bar="left-current"></div>
                            </div>
                            <div class="absolute bottom-1 left-5 w-3 md:bottom-3 md:left-10 md:w-5 h-10 bg-gray-700 items-start opacity-50 rounded-full overflow-hidden" data-help="Right Motor Current">
                                <div class="bg-green-500 opactiy-50" style="height: 0%;" id="rightCurrent-bar" data-hud-bar="right-current"></div>
                            </div>

                            <!-- connection status -->
                            <p id="connectstatus" data-connection-indicator class="absolute md:top-3 md:left-3 top-1 left-1 rounded-full bg-red-500 bg-green-500 md:p-2 p-0.5 opacity-50">Disconnected</p>

                            <!-- video for local webcam (defunct) -->
                            <video id="localcam" class="absolute top-3 left-1/2 rounded-md w-40" autoplay muted></video>

                            <!-- bumpers and wheel drops -->
                            <div class="absolute flex gap-1 md:top-3 top-1 transform left-1/2 -translate-x-1/2 left-3 bg-gray-700 p-1 rounded-xl opacity-50 items-center content-center">
                                <div class="h-3 md:w-10 w-5 bg-black rounded-full" id="bump-left" data-hud-contact="bump-left" data-help="Left Bumper"></div>
                                <div class="h-3 md:w-10 w-5 bg-black rounded-full" id="drop-left" data-hud-contact="drop-left" data-help="Left Wheel Drop"></div>
                                <div class="h-3 md:w-10 w-5 bg-black rounded-full" id="drop-right" data-hud-contact="drop-right" data-help="Right Wheel Drop"></div>
                                <div class="h-3 md:w-10 w-5 bg-black rounded-full" id="bump-right" data-hud-contact="bump-right" data-help="Right Bumper"></div>
                            </div>
        
                            <!-- message box -->
                            <div class="absolute bottom-1 right-1 md:bottom-3 md:right-3 bg-gray-700 p-0 rounded-full overflow-hidden opacity-50">
                                <input type="text" id="messageInput" class="md:p-2 md:px-0 px-1 bg-gray-700 rounded" placeholder="Type your message here">
                                <input type="checkbox" name="Beep?" id="beepcheck" checked data-help="Beep / TTS Toggle">
                                <button id="sendMessageButton" class="md:p-2 md:px-0 px-1 bg-blue-500">Send</button>
                            </div>
                            <!-- end of video and HUD -->
                        </div>

                        <!-- battery bar -->
                        <div class="w-full rounded h-5 overflow-hidden mt-0 md:mt-1 bg-gray-800">
                            <div data-battery-bar class="bg-green-500 h-full text-xs text-center text-black overflow-hidden text-nowrap" style="width: 0%">0%</div>
                        </div>
        
                        <!-- front light bump bars -->
                        <div id="bump-sensors" class="flex gap-1 text-xs md:text-base relative mt-1 hidden md:flex" data-help="Front Proximity Sensors">
                            <div class="w-1/6 h-3 md:h-5 bg-gray-700 flex flex-row-reverse items-end rounded overflow-hidden">
                              <div id="lightbump-L" data-hud-lightbump="L" class="h-full bg-green-500" style="width: 0%;"></div>
                            </div>
                            <div class="w-1/6 h-3 md:h-5 bg-gray-700 flex flex-row-reverse items-end rounded overflow-hidden">
                              <div id="lightbump-FL" data-hud-lightbump="FL" class="h-full bg-green-500" style="width: 0%;"></div>
                            </div>
                            <div class="w-1/6 h-3 md:h-5 bg-gray-700 flex flex-row-reverse items-end rounded overflow-hidden">
                              <div id="lightbump-CL" data-hud-lightbump="CL" class="h-full bg-green-500" style="width: 0%;"></div>
                            </div>
                            <div class="w-1/6 h-3 md:h-5 bg-gray-700 flex items-end rounded overflow-hidden">
                              <div id="lightbump-CR" data-hud-lightbump="CR" class="h-full bg-green-500" style="width: 0%;"></div>
                            </div>
                            <div class="w-1/6 h-3 md:h-5 bg-gray-700 flex items-end rounded overflow-hidden">
                              <div id="lightbump-FR" data-hud-lightbump="FR" class="h-full bg-green-500" style="width: 0%;"></div>
                            </div>
                            <div class="w-1/6 h-3 md:h-5 bg-gray-700 flex items-end rounded overflow-hidden">
                              <div id="lightbump-R" data-hud-lightbump="R" class="h-full bg-green-500" style="width: 0%;"></div>
                            </div>
                        </div>
        
                        <!-- cliff sensor bars -->
                        <div id="cliff-sensors" class="flex gap-1 text-xs md:text-base relative mt-1 hidden md:flex" data-help="Front Drop Sensors">
                            <div class="w-1/4 h-5 bg-gray-700 flex rounded overflow-hidden">
                                <div id="cliff-L" data-hud-cliff="L" class="w-full bg-yellow-500" style="height: 0%"></div>
                            </div>
                            <div class="w-1/4 h-5 bg-gray-700 flex rounded overflow-hidden">
                                <div id="cliff-FL" data-hud-cliff="FL" class="w-full bg-yellow-500" style="height: 0%"></div>
                            </div>
                            <div class="w-1/4 h-5 bg-gray-700 flex rounded overflow-hidden">
                                <div id="cliff-FR" data-hud-cliff="FR" class="w-full bg-yellow-500" style="height: 0%"></div>
                            </div>
                            <div class="w-1/4 h-5 bg-gray-700 flex rounded overflow-hidden">
                                <div id="cliff-R" data-hud-cliff="R" class="w-full bg-yellow-500" style="height: 0%"></div>
                            </div>
                        </div>
                          
                        <!-- raw sensor telemetry panel -->
                        <div id="sensor-data" class="flex flex-wrap md:gap-1 text-xs md:text-base relative mt-1 justify-center hidden md:flex">
                            <p id="charge-status" data-hud-text="charge-status" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="battery-usage" data-hud-text="battery-usage" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="oi-mode" data-hud-text="oi-mode" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="dock-status" data-hud-text="dock-status" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="battery-voltage" data-hud-text="battery-voltage" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="brush-current" data-hud-text="brush-current" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="battery-current" data-hud-text="battery-current" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="cpu-usage" data-hud-text="cpu-usage" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="memory-usage" data-hud-text="memory-usage" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="main-brush-current" data-hud-text="main-brush-current" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="dirt-detect" data-hud-text="dirt-detect" class="md:p-1 bg-gray-700 rounded">No Data</p>
                            <p id="overcurrent-status" data-hud-text="overcurrent-status" class="md:p-1 bg-gray-700 rounded">No Data</p>
                        </div>

                        <!-- end of sensors and camera card -->
                    </div>

                    <!-- small card with "show joystick" button -->
                    <div class="rounded-xl bg-gray-800 shadow-md hidden md:block hover:bg-gray-700 cursor-pointer">
                        <h1 class="text-center text-xl font-bold p-1">Show Joystick Manually</h1>
                    </div>

                    <!-- joystick card for vertical mobile -->
                    <div class="rounded-xl bg-gray-700 shadow-md h-64 md:hidden flex overflow-hidden">
                        <div class="flex flex-col text-xl bg-blue-800">
                            <div class="text-sm p-1 text-center">Brush Controls<br>Hold to use</div>
                            <div class="flex h-1/3">
                                <button class="text-xs w-1/2 bg-green-500 text-black" data-control="aux-main-1">Main Forward</button>
                                <button class="text-xs w-1/2 bg-green-400 text-black" data-control="aux-main-0">Main reverse</button>
                            </div>
                            <div class="flex h-1/3">
                                <button class="text-xs w-1/2 bg-blue-500 text-black" data-control="aux-all-1">All</button>
                                <button class="text-xs w-1/2 bg-red-500 text-black" data-control="aux-vac-1">Vacuum</button>
                            </div>
                            <div class="flex h-1/3">
                                <button class="text-xs w-1/2 bg-yellow-500 text-black" data-control="aux-side-1">Side Forward</button>
                                <button class="text-xs w-1/2 bg-yellow-400 text-black" data-control="aux-side-0">Side Reverse</button>
                            </div>
                        </div>
                        <!-- Joystick area -->
                        <div id="joystick" data-joystick-zone class="relative w-full h-full content-center">
                            <h2 class="text-xl font-bold mb-2 text-center">Joystick area</h2>
                        </div>
                    </div>

                    <!-- end of column 1 -->
                </div>


                <!-- Column 2 -->
                <div class="flex-1 space-y-3 md:h-full md:overflow-y-auto">
                    <!-- Toggle section -->
                    <section class="relative rounded-xl" data-panel-root data-panel-storage-key="newdrive-panels">

                        <!-- tab navigation button container V -->
                        <nav class="absolute left-1/2 top-0 flex transform -translate-x-1/2 gap-1 bg-gray-700 md:p-1 rounded-md opacity-60 mt-1 z-50">
                            <button
                                id="tab-trigger-d"
                                class="tab-trigger rounded-lg border border-gray-600 px-4 py-1 text-xs md:text-sm whitespace-nowrap transition bg-gray-300 text-gray-900"
                                type="button"
                                data-panel-toggle="tab-section-d"
                                data-panel-default
                                aria-pressed="true"
                            >Help</button>
                            <button
                                id="tab-trigger-a"
                                class="tab-trigger rounded-lg border border-gray-600 px-4 py-1 text-xs md:text-sm whitespace-nowrap transition bg-gray-800 text-gray-200"
                                type="button"
                                data-panel-toggle="tab-section-a"
                                aria-pressed="false"
                            >Drive Controls</button>
                            <button
                                id="tab-trigger-b"
                                class="tab-trigger rounded-lg border border-gray-600 px-4 py-1 text-xs md:text-sm whitespace-nowrap transition bg-gray-800 text-gray-200"
                                type="button"
                                data-panel-toggle="tab-section-b"
                                aria-pressed="false"
                            >Room Controls</button>
                            <button
                                id="tab-trigger-c"
                                class="tab-trigger rounded-lg border border-gray-600 px-4 py-1 text-xs md:text-sm whitespace-nowrap transition bg-gray-800 text-gray-200"
                                type="button"
                                data-panel-toggle="tab-section-c"
                                aria-pressed="false"
                            >Utility</button>
                        </nav>



                        <!-- Panels -->
                        <div class="tab-panel" id="tab-section-d" data-panel data-panel-nav="avoid">
                            <!-- TAB D -->
                            <div class="rounded-xl p-1 bg-gray-800 shadow-md">
                                <div id="controls-guide-container" class="space-y-3 text-sm md:text-base">
                                    <section class="bg-gray-700 rounded-xl p-3">
                                        <h2 class="text-lg font-semibold text-center">Getting Started</h2>
                                        <ol class="list-decimal list-inside space-y-1 mt-2">
                                            <li>Check the video feed and confirm the status pill in the top-left says <span class="font-semibold">Connected</span>. If not, refresh the page.</li>
                                            <li>Pick a nickname in the <span class="font-semibold">Drive Controls</span> tab and press <span class="font-semibold">Save</span> so the queue and chat know who you are.</li>
                                            <li>Watch the <span class="font-semibold">Turn Queue</span> card. Enable <span class="font-semibold">Spectate Mode</span> if you want to skip your turn.</li>
                                            <li>Using a non-US keyboard? Configure your preferred keys under <span class="font-semibold">Utility → Keyboard Shortcuts</span> before you start driving.</li>
                                            <li>When your status changes to "It is your turn," press <span class="font-semibold">Start Driving</span>. The rover switches to full driving mode and turns on the room lights.</li>
                                            <li>Drive using the controls below. When you are done, the next driver will take their turn.</li>
                                            <li>Watch the battery level bar below the video feed, if it is low, return to the dock to charge the rover.</li>
                                        </ol>
                                        <!-- <p class="mt-2 text-xs text-gray-300">Need to step away? Toggle <span class="font-semibold">Spectate Mode</span> so the queue keeps moving.</p> -->
                                    </section>
                                    <section class="bg-gray-700 rounded-xl p-3 hidden md:block">
                                        <h3 class="text-base font-semibold text-center md:text-left">Keyboard & Desktop Controls</h3>
                                        <div class="grid grid-cols-2 gap-3 mt-2">
                                            <div>
                                                <p class="font-semibold text-xs uppercase tracking-wide text-gray-300">Driving</p>
                                                <ul class="list-disc list-inside space-y-1 mt-1">
                                                    <li><span class="font-semibold">W / A / S / D</span> — Drive forward, left, backward, right. Combine keys to arc smoothly.</li>
                                                    <li><span class="font-semibold">Shift</span> — Hold for precision speeds and gentle nudges.</li>
                                                    <li><span class="font-semibold">\</span> — Hold for turbo speed (only when the path is clear).</li>
                                                    <li><span class="font-semibold">Enter</span> — Focus the chat box; press again to send your message.</li>
                                                </ul>
                                            </div>
                                            <div>
                                                <p class="font-semibold text-xs uppercase tracking-wide text-gray-300">Cleaning & Extras</p>
                                                <ul class="list-disc list-inside space-y-1 mt-1">
                                                    <li><span class="font-semibold">.</span> — Hold to spin every cleaning motor at once.</li>
                                                    <li><span class="font-semibold">O / L</span> — Side brush forward or reverse.</li>
                                                    <li><span class="font-semibold">I / K</span> — Vacuum motor high or low speed.</li>
                                                    <li><span class="font-semibold">P / ;</span> — Main brush forward or reverse.</li>
                                                    <li>Watch the current bars and warning overlays on the video feed to catch jams early.</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <p class="mt-2 text-xs text-gray-300">
                                            Need a different key? Open <span class="font-semibold">Utility → Keyboard Shortcuts</span> to remap any action for this browser.
                                        </p>
                                    </section>

                                    <section class="bg-gray-700 rounded-xl p-3 md:hidden">
                                        <h3 class="text-base font-semibold text-center">Touch & Mobile Controls</h3>
                                        <ul class="list-disc list-inside space-y-1 mt-2">
                                            <li>Tap <span class="font-semibold">Press To Drive</span> to take control. Tap <span class="font-semibold">Press To Dock</span> when you are finished.</li>
                                            <li>Drag the on-screen joystick to steer. Moving farther from center increases speed; releasing returns the rover to a stop.</li>
                                            <li>Use the aux buttons on the left: <span class="font-semibold">Main Brush Forward/Reverse</span>, <span class="font-semibold">All Brushes</span>, <span class="font-semibold">Vacuum Motor</span>, and <span class="font-semibold">Side Brush Forward/Reverse</span>.</li>
                                            <li>Press and hold an aux button to run that motor; release to stop. The <span class="font-semibold">All Brushes</span> button runs every motor together for quick cleanup.</li>
                                            <li>Rotate your device to landscape for the widest video feed and a dedicated joystick panel.</li>
                                        </ul>
                                    </section>

                                    <section class="bg-gray-700 rounded-xl p-3">
                                        <h3 class="text-base font-semibold text-center md:text-left">Page Tour & Tips</h3>
                                        <ul class="list-disc list-inside space-y-1 mt-2">
                                            <li>The main video shows sensor overlays: the blinking dot confirms live data, and red banners warn about charging or overcurrent issues.</li>
                                            <li>Use the tab bar above to toggle <span class="font-semibold">Help</span>, <span class="font-semibold">Drive Controls</span>, <span class="font-semibold">Room Controls</span>, and <span class="font-semibold">Utility</span>.</li>
                                            <li><span class="font-semibold">Room Controls</span> provides the room camera and light toggles so spectators can see the rover.</li>
                                            <li>Chat with other drivers in the <span class="font-semibold">Chat Messages</span> card. Share when you are docking so the next person can get ready.</li>
                                            <!-- <li>Need a different keyboard layout? Open <span class="font-semibold">Utility → Keyboard Shortcuts</span> to remap keys in your browser.</li> -->
                                            <li>If the page behaves oddly, reload. Most settings (like hidden panels) are remembered per browser.</li>
                                        </ul>
                                    </section>
                                </div>
                            </div>
                            <!-- TAB D END -->
                        </div>

                        <div class="tab-panel hidden" id="tab-section-b" data-panel data-panel-nav="overlap">
                            <!-- TAB B -->
                            <div id="room-controls" class="rounded-xl shadow-md p-1 bg-gray-800">
                                <div id="room-camera-container" class="relative">
                                   <div id="room-blinker" data-room-camera-blinker class="absolute right-3 top-3 w-5 h-5 rounded-full bg-green-500 opacity-50"></div>
                                   <div class="absolute top-3 left-3 italic bg-gray-800 opacity-50 p-1 rounded-xl">Room Camera</div>
                                   <img id="room-camera" data-room-camera class="w-full max-w-full rounded-md" alt="Room Camera Stream"></img>
            
                                   <div id="light-button-container" data-room-lights class="absolute flex gap-1 top-14 transform left-1/2 -translate-x-1/2 left-3 p-1 rounded-xl items-center content-center opacity-50 md:opacity-100">
                                       <!-- buttons injected by JS -->
                                    </div>
                               </div>
                           </div>
                            <!-- TAB B END -->
                        </div>

                        <div class="tab-panel hidden" id="tab-section-a" data-panel data-panel-nav="avoid">
                            <!-- TAB A -->
                            <!-- drive mode controls -->
                            <div id="rover-controls" class="items-center content-center w-full justify-center md:flex gap-1">
                                <button class="btn bg-green-600 md:w-1/2 w-full hover:opacity-80" data-drive-button="start" onclick="easyStart()">
                                    <p class="text-xl">Start Driving</p>
                                    <p>Press to enable driving mode, then start driving! The lights should turn on if they are off.</p>
                                    <p class="bg-green-500 bg-red-500 rounded-xl" id="start-button-message" data-drive-status="start-message">Not Ready!</p>
                                </button>
                                <button class="btn bg-indigo-600 md:w-1/2 w-full mt-1 md:mt-0 hover:opacity-80" data-drive-button="dock" onclick="easyDock()">
                                    <p class="text-xl">Dock and Charge</p>
                                    <p>Line up head on about a foot from the dock, press this button and the rover will dock itself.</p>
                                    <div class="flex gap-1">
                                        <p class="bg-green-500 bg-red-500 rounded-xl w-1/2" id="dock-button-message" data-drive-status="dock-message">Not Docked!</p>
                                        <p class="bg-green-500 bg-red-500 rounded-xl w-1/2" id="dock-button-charging-message" data-drive-status="dock-charge-message">Not Charging!</p>
                                    </div>
                                </button>
                            </div>

                            <!-- nickname stuff -->
                            <div class="rounded-xl shadow-md bg-gray-800 p-1 mt-1">
                                <p class="text-sm text-gray-200">Choose a nickname so others recognize you in chat and the turns queue.</p>
                                <div class="flex flex-col gap-1 sm:flex-row sm:items-center">
                                    <input type="text" id="nickname-input" class="flex-1 rounded-xl bg-gray-700 p-1 text-white placeholder-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Choose a nickname" />
                                    <div class="flex flex-col gap-1 w-full sm:w-auto sm:flex-row">
                                        <button id="nickname-save-button" type="button" class="w-full sm:w-auto bg-purple-600 text-white rounded-xl px-2 py-1 font-semibold hover:bg-purple-500 transition-colors">Save</button>
                                        <a id="discord-invite-button" href="#" target="_blank" rel="noopener noreferrer" class="w-full sm:w-auto hover:opacity-60 text-white rounded-xl px-4 py-2 font-semibold transition-colors text-center rainbow-bg">Join our Discord server for updates!</a>
                                    </div>
                                </div>
                                <p id="nickname-status" class="text-xs text-gray-200 hidden"></p>
                            </div>
                            <!-- turns card -->
                            <div class="rounded-xl shadow-md bg-gray-800 p-1 mt-1" id="turn-queue-card" data-turns-card>
                                <p class="text-lg font-semibold text-center flex items-center justify-center gap-2">
                                    Turn Queue 
                                    <label for="spectate-mode-checkbox" class="flex items-center gap-1 bg-blue-800 rounded-xl px-1">
                                        <input type="checkbox" id="spectate-mode-checkbox" data-spectate-toggle title="Skip my Turn">
                                        Spectate Mode
                                    </label>
                                    <a href="/spectate" class="text-xs bg-yellow-500 rounded-xl p-1 hover:opacity-80">Spectator Page</a>
                                </p>
                                <p id="turn-queue-your-status" data-turns-status class="text-sm bg-gray-700 rounded-xl p-2 mt-1 text-center">Turns mode not active.</p>
                                <p id="turn-queue-countdown" data-turns-countdown class="text-sm text-center mt-1"></p>
                                <div class="mt-2">
                                    <p class="text-sm font-semibold">Upcoming Drivers</p>
                                    <div id="turn-queue-list" data-turns-list class="mt-1 flex flex-col gap-1"></div>
                                </div>
                            </div>
                            <!-- chat card -->
                            <div class="rounded-xl shadow-md p-1 bg-gray-800 mt-1" id="chat-messages-card">
                                <p class="text-lg font-semibold text-center">Chat Messages</p>
                                <div id="chat-messages-list" class="mt-1 flex flex-col gap-1 text-sm max-h-48 overflow-y-auto"></div>
                            </div>

                            <!-- logs card -->
                            <div class="rounded-xl shadow-md p-1 bg-gray-800 mt-1">
                                <p class="text-lg font-semibold text-center hidden md:block">Logs</p>
                                <div id="log-container" class="h-40 overflow-scroll bg-gray-700 rounded-xl p-2">
                                    <p class="text-sm text-gray-300">Logs will appear here...</p>
                                </div>
                            </div>

                            <!-- TAB A END -->
                        </div>

                        

                        <div class="tab-panel hidden" id="tab-section-c" data-panel data-panel-nav="avoid">
                            <!-- TAB C -->
                            <!-- admin login card -->
                            <form id="inline-password-form" class="flex flex-col gap-2 sm:flex-row sm:items-center mt-1">
                                <input id="inline-password-input" type="password" class="flex-1 rounded-xl bg-gray-700 p-2 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Access code (optional)" />
                                <button type="submit" class="w-full sm:w-auto bg-blue-600 text-white rounded-xl px-4 py-2 font-semibold hover:bg-blue-500 transition-colors">Log in</button>
                            </form>
            
                            <div class="hidden" id="admin-settings">
                                <select id="access-mode-select" class="w-full rounded-xl bg-gray-700 p-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 w-1/2">
                                    <option value="open">Open</option>
                                    <option value="turns">Turns</option>
                                    <option value="admin">Admin</option>
                                    <option value="lockdown">LOCKDOWN (OWNER PRIVACY MODE)</option>
                                </select>
                            </div>

                            <div class="">
                                <button
                                    type="button"
                                    data-layout-toggle
                                    class="layout-toggle-button bg-gray-700 text-white text-xs px-3 py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    aria-pressed="false"
                                >Layout: Auto</button>
                            </div>

                            <!-- admin controls -->
                            <div class="hidden" id="advanced-controls">
                                <p class="text-lg font-semibold text-center">Advanced Controls (Careful!)</p>
                                <div class="flex gap-2 mt-2 flex-wrap justify-center">
                                    <button onclick="dockNow()" class="btn bg-indigo-400">Dock / Passive</button>
                                    <button onclick="reconnectRoomba()" class="btn bg-pink-400">Reconnect / Full</button>
                                    <button onclick="startAV()" class="btn bg-green-500">Start A/V</button>
                                    <button onclick="stopAV()" class="btn bg-red-600">Stop A/V</button>
                                    <button onclick="sensorData()" class="btn bg-blue-600">Start Sensor Data</button>
                                    <button onmousedown="sideBrush('forward')" onmouseup="sideBrush('stop')" class="btn bg-red-300">Side brush (hold)</button>
                                    <button onclick="startWebcam()" class="btn bg-green-500">Start your webcam</button>
                
                                    <div class="rounded-xl bg-gray-700 p-1">
                                        <input type="checkbox" id="rebootconfirm">
                                        <button onclick="rebootServer()" class="btn bg-pink-900">REBOOT SERVER</button>
                                    </div>
                                </div>
                            </div>

                            <section class="rounded-xl shadow-md bg-gray-800 p-2 mt-2 space-y-2" data-keybindings-root>
                                <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                                    <p class="text-lg font-semibold text-center sm:text-left">Keyboard Shortcuts</p>
                                    <button
                                        type="button"
                                        class="text-xs bg-blue-700 hover:bg-blue-600 text-white rounded px-2 py-1 font-semibold transition-colors"
                                        data-keybindings-reset-all
                                    >Reset All</button>
                                </div>
                                <p class="text-xs text-gray-300 text-center sm:text-left">
                                    Customize which keys control driving, cleaning, and chat. Changes save in this browser only.
                                </p>
                                <p class="text-xs hidden text-center sm:text-left" data-keybindings-status></p>
                                <div class="space-y-2" data-keybindings-list></div>
                            </section>
                            <!-- TAB C END -->
                        </div>
                    </section>
                </div>
            </section>


            <!-- Mobile landscape layout MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE MOBILE LANDSCAPE -->
            <section id="layout-landscape" class="hidden mobile-landscape:block md:flex-1 mobile-landscape:h-auto mobile-landscape:overflow-y-auto">
                <!-- Landscape grid: controls and primary canvas -->
                <div class="flex">
                    <!-- left side V -->
                    <div class="bg-green-400 h-screen w-1/4">
                        <div class="flex flex-col text-xl bg-black h-screen w-full p-1">
                            <div class="flex h-1/4 gap-1">
                                <button
                                    type="button"
                                    data-mobile-action="drive"
                                    class="flex-1 flex flex-col items-center justify-center rounded-md border border-gray-600 bg-red-600 text-sm font-semibold text-white transition-colors"
                                >
                                    <span>Press To Drive</span>
                                    <span data-mobile-action-label="drive" class="text-xs opacity-80">Not Ready</span>
                                </button>
                                <button
                                    type="button"
                                    data-mobile-action="dock"
                                    class="flex-1 flex flex-col items-center justify-center rounded-md border border-gray-600 bg-indigo-500 text-sm font-semibold text-white transition-colors"
                                >
                                    <span>Press To Dock</span>
                                    <span data-mobile-action-label="dock" class="text-xs opacity-80">Undocked</span>
                                </button>
                            </div>
                            <!-- <div class="text-sm p-1 text-center">Brush Controls<br>Hold to use</div> -->
                            <div class="flex h-1/4 gap-1 mt-1">
                                <button class="text-xs w-1/2 bg-green-500 text-black rounded active:opacity-50" data-control="aux-main-1">Main Brush Forward</button>
                                <button class="text-xs w-1/2 bg-green-400 text-black rounded focus:opacity-50" data-control="aux-main-0">Main Brush reverse</button>
                            </div>
                            <div class="flex h-1/4 gap-1 mt-1">
                                <button class="text-xs w-1/2 bg-blue-500 text-black rounded" data-control="aux-all-1">All Brushes</button>
                                <button class="text-xs w-1/2 bg-red-500 text-black rounded" data-control="aux-vac-1">Vacuum Motor</button>
                            </div>
                            <div class="flex h-1/4 gap-1 mt-1">
                                <button class="text-xs w-1/2 bg-yellow-500 text-black rounded" data-control="aux-side-1">Side Brush Forward</button>
                                <button class="text-xs w-1/2 bg-yellow-400 text-black rounded" data-control="aux-side-0">Side Brush Reverse</button>
                            </div>
                        </div>
                    </div>
                    <!-- middle V -->
                    <div class="flex h-screen w-full flex-col">
                        <div class="flex-1 bg-black">
                            <div class="relative h-full">
                                <iframe
                                    class="h-full w-full border-none"
                                    src="https://rover.otter.land/rover-video/"
                                    allow="autoplay; fullscreen"
                                    data-drive-video="secondary"
                                ></iframe>
                                <div data-hud-role="overcurrent-warning" class="hidden absolute inset-x-6 top-1/3 transform bg-red-700 bg-opacity-90 px-1 py-1 rounded-xl text-sm font-bold text-white text-center shadow-lg"></div>
                                <div data-hud-role="charge-warning" class="hidden absolute left-1/2 top-4 transform -translate-x-1/2 bg-red-700 bg-opacity-90 px-1 py-1 rounded-xl text-xs font-semibold text-white shadow-md"></div>
                                <div data-hud-role="sensor-blinker" class="absolute right-2 top-2 h-3 w-3 rounded-full bg-pink-400 opacity-70"></div>
                                <div class="absolute bottom-3 left-2 w-3 h-16 bg-gray-700 bg-opacity-60 rounded-full overflow-hidden">
                                    <div data-hud-bar="left-current" class="bg-green-500" style="height: 0%"></div>
                                </div>
                                <div class="absolute bottom-3 left-6 w-3 h-16 bg-gray-700 bg-opacity-60 rounded-full overflow-hidden">
                                    <div data-hud-bar="right-current" class="bg-green-500" style="height: 0%"></div>
                                </div>
                                <p data-connection-indicator class="absolute top-2 left-2 rounded-full bg-red-500 px-2 py-0.5 text-xs uppercase tracking-wide opacity-80">Disconnected</p>
                                <div class="absolute flex gap-1 top-2 left-1/2 -translate-x-1/2 bg-gray-700 bg-opacity-60 px-1 py-0.5 rounded-lg">
                                    <div data-hud-contact="bump-left" class="h-2 w-6 bg-black rounded-full"></div>
                                    <div data-hud-contact="drop-left" class="h-2 w-6 bg-black rounded-full"></div>
                                    <div data-hud-contact="drop-right" class="h-2 w-6 bg-black rounded-full"></div>
                                    <div data-hud-contact="bump-right" class="h-2 w-6 bg-black rounded-full"></div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-black flex items-center gap-2 p-1">
                            <div class="flex-1 rounded h-5 overflow-hidden bg-gray-800">
                                <div data-battery-bar class="bg-green-500 h-full text-xs text-center text-black overflow-hidden text-nowrap" style="width: 0%">0%</div>
                            </div>
                            <p class="text-xs text-gray-300 whitespace-nowrap">Scroll for more</p>
                        </div>
                    </div>


                    <!-- right V -->
                    <div class="bg-red-400 h-screen w-1/3">
                        <!-- Joystick area -->
                        <div data-joystick-zone class="relative w-full h-full content-center">
                            <h2 class="text-xl font-bold mb-2 text-center">Joystick area</h2>
                        </div>
                    </div>
                </div>


                <div class="w-screen bg-gray-700 h-screen overflow-y-block">
                    <!-- scroll-down menu -->
                    <div class="p-1 space-y-3">
                        <div class="grid grid-cols-1 gap-3 min-[720px]:grid-cols-2">
                            <section class="rounded-xl bg-gray-800 p-1 shadow-md" data-turns-card>
                                <div class="flex items-center justify-between flex-wrap gap-2">
                                    <p class="text-lg font-semibold">Turn Queue</p>
                                    <label class="flex items-center gap-1 bg-blue-800 rounded-xl px-1 py-1 text-xs">
                                        <input type="checkbox" data-spectate-toggle title="Skip my Turn">
                                        Spectate
                                    </label>
                                    <a href="/spectate" class="text-xs bg-yellow-500 rounded-xl px-1 py-1 hover:opacity-80">Spectator Page</a>
                                </div>
                                <p data-turns-status class="text-sm bg-gray-700 rounded-xl p-1 mt-2 text-center">Turns mode not active.</p>
                                <p data-turns-countdown class="text-sm text-center mt-1"></p>
                                <div class="mt-2">
                                    <p class="text-sm font-semibold">Upcoming Drivers</p>
                                    <div data-turns-list class="mt-1 flex flex-col gap-1"></div>
                                </div>
                            </section>
                            <section class="rounded-xl bg-gray-800 p-1 shadow-md space-y-2">
                                <p class="text-sm font-semibold text-center">Sensor Snapshot</p>
                                <div class="flex flex-wrap justify-center gap-1 text-xs">
                                    <p data-hud-text="charge-status" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="battery-usage" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="oi-mode" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="dock-status" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="battery-voltage" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="brush-current" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="battery-current" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="main-brush-current" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="dirt-detect" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="overcurrent-status" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="cpu-usage" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                    <p data-hud-text="memory-usage" class="bg-gray-700 rounded px-2 py-1">No Data</p>
                                </div>
                                <div class="grid grid-cols-6 gap-1 text-xs" data-help="Front Proximity Sensors">
                                    <div class="h-3 bg-gray-700 rounded overflow-hidden">
                                        <div data-hud-lightbump="L" class="h-full bg-green-500" style="width: 0%"></div>
                                    </div>
                                    <div class="h-3 bg-gray-700 rounded overflow-hidden">
                                        <div data-hud-lightbump="FL" class="h-full bg-green-500" style="width: 0%"></div>
                                    </div>
                                    <div class="h-3 bg-gray-700 rounded overflow-hidden">
                                        <div data-hud-lightbump="CL" class="h-full bg-green-500" style="width: 0%"></div>
                                    </div>
                                    <div class="h-3 bg-gray-700 rounded overflow-hidden">
                                        <div data-hud-lightbump="CR" class="h-full bg-green-500" style="width: 0%"></div>
                                    </div>
                                    <div class="h-3 bg-gray-700 rounded overflow-hidden">
                                        <div data-hud-lightbump="FR" class="h-full bg-green-500" style="width: 0%"></div>
                                    </div>
                                    <div class="h-3 bg-gray-700 rounded overflow-hidden">
                                        <div data-hud-lightbump="R" class="h-full bg-green-500" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-4 gap-1 text-xs" data-help="Front Drop Sensors">
                                    <div class="h-12 bg-gray-700 rounded overflow-hidden">
                                        <div data-hud-cliff="L" class="w-full bg-yellow-500" style="height: 0%"></div>
                                    </div>
                                    <div class="h-12 bg-gray-700 rounded overflow-hidden">
                                        <div data-hud-cliff="FL" class="w-full bg-yellow-500" style="height: 0%"></div>
                                    </div>
                                    <div class="h-12 bg-gray-700 rounded overflow-hidden">
                                        <div data-hud-cliff="FR" class="w-full bg-yellow-500" style="height: 0%"></div>
                                    </div>
                                    <div class="h-12 bg-gray-700 rounded overflow-hidden">
                                        <div data-hud-cliff="R" class="w-full bg-yellow-500" style="height: 0%"></div>
                                    </div>
                                </div>
                            </section>
                        </div>
                        <section class="rounded-xl bg-gray-800 p-1 shadow-md">
                            <div class="relative">
                                <div data-room-camera-blinker class="absolute right-1 top-1 h-4 w-4 rounded-full bg-green-500 opacity-60"></div>
                                <div class="absolute left-1 top-1 italic bg-gray-900 bg-opacity-70 px-1 py-1 rounded-lg text-xs">Room Camera</div>
                                <img data-room-camera class="w-full rounded-md" alt="Room Camera Stream">
                                <div data-room-lights class="absolute top-14 left-1/2 -translate-x-1/2 flex flex-wrap justify-center gap-1 p-1 rounded-xl bg-gray-900 bg-opacity-70">
                                    <!-- buttons injected by JS -->
                                </div>
                            </div>
                        </section>
                        <div class="pt-1">
                            <button
                                type="button"
                                data-layout-toggle
                                class="layout-toggle-button w-full bg-gray-800 text-white text-sm px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                aria-pressed="false"
                            >Layout: Auto</button>
                        </div>
                    </div>
                </div>
            </section>


        </main>
    </div>

    <!-- toast container -->
    <div id="toast-container" class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50 flex flex-col items-center space-y-2 pointer-events-none"></div>


    <script>
        window.__ROVER_FEATURES__ = {
            allowChatSend: true,
            allowLightControl: true,
            requireAdminLogin: true
        };
        </script>
        <script>
        window.__ROVER_SOCKET_CONFIG__ = {
            useClientKey: false
        };
    </script>
    <script src="/js/newdrive-app.js" type="module"></script>
</body>
</html>
